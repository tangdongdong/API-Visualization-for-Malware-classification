package main;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.Map;
import java.io.File;
import main.MalwareVisualization;

public class Main {
	public static void main(String[] args) {

		MalwareVisualization malwareVisualization = new MalwareVisualization();
		Map<Integer, HashSet<String>> APIMap = malwareVisualization
				.getAPIList();
		// load the color mapping rules
		int[][] colorMappingRules = malwareVisualization.getColorMappingRules();
		// Split API Sequences to K fragments, where K = number of 'unit time'
		Map<Integer, ArrayList<String>> fragments = null;
		int[][] occurCounterMatrix = null;
		int[][] colorValueMatrix = null;

		/*
		 * Please replace the relative address with an Absolute Address
		 * here, to ensure proper operation of the program
		 */
		File reportDir = new File("../../report/");
		String imagesDir = "../../images/";
		File[] reports = reportDir.listFiles();
		
		String desPath = null;
		for (File report : reports) {
			fragments = malwareVisualization.equalDivide(malwareVisualization
					.getJsonObject(report.getAbsolutePath()));
			occurCounterMatrix = malwareVisualization.getOccurCounterMatrix(
					fragments, APIMap);
			colorValueMatrix = malwareVisualization.colorValueMatrix(
					occurCounterMatrix, colorMappingRules);
			desPath = imagesDir + report.getName().replace(".json", ".jpg");
			malwareVisualization.generateImage(colorValueMatrix, desPath);
		}

		System.out.println("Finish, and the feature images were stored in 'images' directory");
	}
}
